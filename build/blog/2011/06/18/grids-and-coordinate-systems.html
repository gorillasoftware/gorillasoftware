<!DOCTYPE html>
<html>
<head>
<meta content='width=device-width' name='viewport'>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<title>Grids & Coordinate Systems</title>
<link href="../../../../stylesheets/app-9744b2ed.css" media="screen" rel="stylesheet" type="text/css" />
<link href="../../../../stylesheets/style-da39a3ee.css" media="screen" rel="stylesheet" type="text/css" />
<script src="../../../../javascripts/modernizr-e809af06.js" type="text/javascript"></script>
<script src="//use.typekit.net/iof8zoc.js" type="text/javascript"></script>
<script>
  try{Typekit.load();}catch(e){}
</script>
</head>
<body class='blog blog_2011 blog_2011_06 blog_2011_06_18 blog_2011_06_18_grids-and-coordinate-systems'>
<div class='contain-to-grid'>
<nav class='top-bar'>
<ul class='title-area'>
<li class='name'>
<h1>
<a href="/">gorilla software</a>
</h1>
</li>
<li class='toggle-topbar menu-icon'>
<a href='#'>
<span></span>
</a>
</li>
</ul>
<section class='top-bar-section'>
<ul class='right'>
<li>
<a href="/#about">Was</a>
</li>
<li>
<a href="/#team">Wer</a>
</li>
<li>
<a href="/#services">Wie</a>
</li>
<li>
<a href="/#contact">Kontakt</a>
</li>
<li class='has-dropdown'>
<a href="/blog.html">Blog</a>
<ul class='dropdown'>
<li>
<label>Recent Articles</label>
</li>
<li>
<a href="/blog/2011/10/27/hide-os-x-mouse-cursor.html">Hide OS X Mouse Cursor</a>
</li>
<li>
<a href="/blog/2011/07/07/Path-and-Encirclement-Detection.html">Path and Encirclement Detection</a>
</li>
<li>
<a href="/blog/2011/06/29/Birom-Dilemma-I.html">Birom Dilemma I</a>
</li>
<li>
<a href="/blog/2011/06/28/MeFailEnglish.html">Me fail english</a>
</li>
<li>
<a href="/blog/2011/06/24/cake-task-completion-for-zsh.html">Cake Task Completion for Zsh</a>
</li>
<li>
<a href="/blog/2011/06/18/office.html">New Office</a>
</li>
<li>
<a href="/blog/2011/06/18/grids-and-coordinate-systems.html">Grids & Coordinate Systems</a>
</li>
<li><a href="/blog.html">See all →</a></li>
<li class='divider'></li>
<li>
<label>Tags</label>
</li>
<li>
<a href="/blog/tags/misc.html">misc (1)</a>
</li>
<li class='divider'></li>
<li>
<label>By Year</label>
</li>
<li>
<a href="/blog/2011.html">2011 (7)</a>
</li>
</ul>
</li>
</ul>
</section>
</nav>
</div>

<div class='row'>
<div class='content columns large-8'>
<h1>Grids & Coordinate Systems</h1>
<div class='separator'>
<div class='line line-1'></div>
</div>
<div>
<div>
<p>
For a software project (a multi-user browser game) I am currently
evaluating different sorts of grid and coordinate system combinations. I
came across a few great posts about that topic (
<a href='http://www-cs-students.stanford.edu/~amitp/game-programming/grids/'>Amit’s Thoughts on Grids</a>
and
<a href='http://simblob.blogspot.com/2007/06/distances-on-triangular-grid.html'>Blobs in Games: Distances on a triangular grid</a>).
The latter provides a promising coordinate system based on
<a href='http://cit.zesoi.fer.hr/downloadPaper.php?paper=435'>this paper</a>.
To review the grid and coordinate system I put together an example.
</p>
<h2>Example</h2>
<p>Move your mouse over the grid.</p>
<div id='paper' style='height: 500px; background-color: #444;'></div>
<p>
Crossing an edge changes exactly one coordinate.
</p>
<p>
The graphics are generated by
<a href='http://raphaeljs.com'>Raphaël</a>.
</p>
<ul>
<li><span style='color: white; background: darkred;'>darkred</span>,
<span style='color: white; background: darkblue;'>darkblue</span>
and
<span style='color: white; background: darkgreen;'>darkgreen</span>:
u, v and w-lane (the corresponding coordinate does not change on that lane)
</li>
<li><span style='color: white; background: red;'>red</span>: highlighted triangle
</li>
<li><span style='color: white; background: blue;'>blue</span>: neighbours of the highlighted triangle (triangles with at least one shared vertex)
</li>
</ul>
<h2>Code</h2>
<p>
The conversion code is written in Coffeescript.
</p>
<pre class="highlight ruby"><span class="c1"># some constants</span>
<span class="no">SR3</span> <span class="o">=</span> <span class="no">Math</span><span class="nf">.sqrt</span> <span class="mi">3</span>
<span class="no">PI30</span> <span class="o">=</span> <span class="no">Math</span><span class="o">.</span><span class="no">PI</span> <span class="o">/</span> <span class="mi">6</span>
<span class="no">PI60</span> <span class="o">=</span> <span class="no">Math</span><span class="o">.</span><span class="no">PI</span> <span class="o">/</span> <span class="mi">3</span>
<span class="no">SIN30</span> <span class="o">=</span> <span class="no">Math</span><span class="nf">.sin</span> <span class="no">PI30</span>
<span class="no">COS30</span> <span class="o">=</span> <span class="no">Math</span><span class="nf">.cos</span> <span class="no">PI30</span>
<span class="no">SIN60</span> <span class="o">=</span> <span class="no">Math</span><span class="nf">.sin</span> <span class="no">PI60</span>
<span class="no">COS60</span> <span class="o">=</span> <span class="no">Math</span><span class="nf">.cos</span> <span class="no">PI60</span>
<span class="c1"># convert u/v/w coordinates to x/y coordinates based on the</span>
<span class="c1"># side length s</span>
<span class="n">to_xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="o">-&gt;</span>
<span class="n">r</span> <span class="o">=</span> <span class="no">SR3</span> <span class="o">*</span> <span class="n">s</span> <span class="o">/</span> <span class="mi">6</span>
<span class="n">R</span> <span class="o">=</span> <span class="no">SR3</span> <span class="o">*</span> <span class="n">s</span> <span class="o">/</span> <span class="mi">3</span>
<span class="n">h</span> <span class="o">=</span> <span class="no">SR3</span> <span class="o">*</span> <span class="n">s</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">xu</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">yu</span> <span class="o">=</span> <span class="n">u</span> <span class="o">*</span> <span class="n">R</span>
<span class="n">xv</span> <span class="o">=</span> <span class="o">-</span><span class="n">v</span> <span class="o">*</span> <span class="no">COS30</span> <span class="o">*</span> <span class="n">R</span>
<span class="n">yv</span> <span class="o">=</span> <span class="o">-</span><span class="n">v</span> <span class="o">*</span> <span class="no">SIN30</span> <span class="o">*</span> <span class="n">R</span>
<span class="n">xw</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="no">COS30</span> <span class="o">*</span> <span class="n">R</span>
<span class="n">yw</span> <span class="o">=</span> <span class="o">-</span><span class="n">w</span> <span class="o">*</span> <span class="no">SIN30</span> <span class="o">*</span> <span class="n">R</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">xu</span> <span class="o">+</span> <span class="n">xv</span> <span class="o">+</span> <span class="n">xw</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">yu</span> <span class="o">+</span> <span class="n">yv</span> <span class="o">+</span> <span class="n">yw</span>
<span class="o">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">]</span>
<span class="c1"># convert x/y coordinates to u/v/w coordinates based on the</span>
<span class="c1"># side length s</span>
<span class="n">to_uvw</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">-&gt;</span>
<span class="k">return</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span> <span class="k">if</span> <span class="n">x</span> <span class="n">is</span> <span class="mi">0</span> <span class="n">and</span> <span class="n">y</span> <span class="n">is</span> <span class="mi">0</span>
<span class="n">r</span> <span class="o">=</span> <span class="no">SR3</span> <span class="o">*</span> <span class="n">s</span> <span class="o">/</span> <span class="mi">6</span>
<span class="n">R</span> <span class="o">=</span> <span class="no">SR3</span> <span class="o">*</span> <span class="n">s</span> <span class="o">/</span> <span class="mi">3</span>
<span class="n">h</span> <span class="o">=</span> <span class="no">SR3</span> <span class="o">*</span> <span class="n">s</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="no">Math</span><span class="nf">.floor</span> <span class="p">(</span><span class="n">R</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">h</span><span class="p">)</span>
<span class="k">if</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="n">factor</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">offset</span> <span class="o">=</span> <span class="n">r</span>
<span class="k">else</span>
<span class="n">factor</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">offset</span> <span class="o">=</span> <span class="n">R</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">factor</span> <span class="o">*</span> <span class="p">(</span><span class="no">Math</span><span class="nf">.floor</span> <span class="p">(</span><span class="no">Math</span><span class="nf">.cos</span><span class="p">(</span><span class="no">PI60</span> <span class="o">-</span> <span class="p">(</span><span class="no">Math</span><span class="nf">.atan</span> <span class="n">x</span><span class="o">/</span><span class="n">y</span><span class="p">))</span> <span class="o">*</span> <span class="no">Math</span><span class="nf">.sqrt</span><span class="p">(</span><span class="no">Math</span><span class="nf">.pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="no">Math</span><span class="nf">.pow</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">/</span> <span class="n">h</span><span class="p">)</span>
<span class="k">if</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="n">factor</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">offset</span> <span class="o">=</span> <span class="n">R</span>
<span class="k">else</span>
<span class="n">factor</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">offset</span> <span class="o">=</span> <span class="n">r</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">factor</span> <span class="o">*</span> <span class="p">(</span><span class="no">Math</span><span class="nf">.floor</span> <span class="p">(</span><span class="no">Math</span><span class="nf">.cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="no">PI60</span> <span class="o">-</span> <span class="p">(</span><span class="no">Math</span><span class="nf">.atan</span> <span class="n">x</span><span class="o">/</span><span class="n">y</span><span class="p">))</span> <span class="o">*</span> <span class="no">Math</span><span class="nf">.sqrt</span><span class="p">(</span><span class="no">Math</span><span class="nf">.pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="no">Math</span><span class="nf">.pow</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">/</span> <span class="n">h</span><span class="p">)</span>
<span class="o">[</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="o">]</span>
</pre>
</div>
</div>

</div>
<aside class='nav columns large-4'>
<h2>Recent Articles</h2>
<ol>
<li>
<a href="/blog/2011/10/27/hide-os-x-mouse-cursor.html">Hide OS X Mouse Cursor</a>
<span>Oct 27</span>
</li>
<li>
<a href="/blog/2011/07/07/Path-and-Encirclement-Detection.html">Path and Encirclement Detection</a>
<span>Jul  7</span>
</li>
<li>
<a href="/blog/2011/06/29/Birom-Dilemma-I.html">Birom Dilemma I</a>
<span>Jun 29</span>
</li>
<li>
<a href="/blog/2011/06/28/MeFailEnglish.html">Me fail english</a>
<span>Jun 28</span>
</li>
<li>
<a href="/blog/2011/06/24/cake-task-completion-for-zsh.html">Cake Task Completion for Zsh</a>
<span>Jun 24</span>
</li>
<li>
<a href="/blog/2011/06/18/office.html">New Office</a>
<span>Jun 18</span>
</li>
<li>
<a href="/blog/2011/06/18/grids-and-coordinate-systems.html">Grids & Coordinate Systems</a>
<span>Jun 18</span>
</li>
</ol>
<h2>Tags</h2>
<ol>
<li>
<a href="/blog/tags/misc.html">misc</a>
(1)
</li>
</ol>
<h2>By Year</h2>
<ol>
<li>
<a href="/blog/2011.html">2011</a>
(7)
</li>
</ol>

</aside>
</div>
<div id='footer'>
<div class='ruler'></div>
<div class='newsletter row'>
<form action='http://gorillasoftware.us7.list-manage.com/subscribe/post?u=5a4a472acf94be0e77c5796b6&amp;id=e9c19870ae' method='post' name='mc-embedded-subscribe-form' novalidate='' target='_blank'>
<div class='columns medium-12 large-3'>
<h2>Newsletter</h2>
</div>
<div class='columns medium-9 large-7'>
<input class='email' id='newsletter' name='EMAIL' placeholder='email address' required='' type='email' value=''>
</div>
<div class='columns medium-3 large-2'>
<a onclick="$(this).closest(&quot;form&quot;).submit(); return false;" class="subscribe" href="#">Subscribe</a>
</div>
</form>
</div>
<div class='credits row'>
<div class='columns small-12'>Copyright © gorilla software GmbH 2011-2013. All Rights Reserved.</div>
</div>
</div>

<script src="http://code.jquery.com/jquery-1.10.1.min.js" type="text/javascript"></script>
<script src="../../../../javascripts/site-06704b5d.js" type="text/javascript"></script>
<script src="../../../../javascripts/blog/2011-06-18-grids-and-coordinate-systems/raphael-49b8fd9d.js" type="text/javascript"></script>
<script src="../../../../javascripts/blog/2011-06-18-grids-and-coordinate-systems/util-369ff411.js" type="text/javascript"></script>
<script src="../../../../javascripts/blog/2011-06-18-grids-and-coordinate-systems/triangles-03c0b0a1.js" type="text/javascript"></script>

</body>
</html>
