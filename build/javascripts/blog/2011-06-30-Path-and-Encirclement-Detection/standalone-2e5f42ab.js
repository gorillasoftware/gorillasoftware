var require=function(e,r){var t=require.resolve(e,r||"/"),n=require.modules[t];if(!n)throw new Error("Failed to resolve module "+e+", tried "+t);var o=n._cached?n._cached:n();return o},__require=require;require.paths=[],require.modules={},require.extensions=[".js",".coffee"],require.resolve=function(){var e=["assert","events","fs","path","vm"].reduce(function(e,r){return e[r]=!0,e},{});return function(r,t){function n(e){var r;r="/"===e?[""]:s.normalize(e).split(/\/+/);for(var t=[],n=r.length-1;n>=0;n--)if("node_modules"!==r[n]){var o=r.slice(0,n+1).join("/")+"/node_modules";t.push(o)}return t}function o(e,r){for(var t=n(r),o=0;o<t.length;o++){var s=t[o],a=i(s+"/"+e);if(a)return a;var c=u(s+"/"+e);if(c)return c}var a=i(e);return a?a:void 0}function u(e){e=e.replace(/\/+$/,"");var r=e+"/package.json";if(require.modules[r]){var t=require.modules[r](),n=t.browserify;if("object"==typeof n&&n.main){var o=i(s.resolve(e,n.main));if(o)return o}else if("string"==typeof n){var o=i(s.resolve(e,n));if(o)return o}else if(t.main){var o=i(s.resolve(e,t.main));if(o)return o}}return i(e+"/index")}function i(e){if(require.modules[e])return e;for(var r=0;r<require.extensions.length;r++){var t=require.extensions[r];if(require.modules[e+t])return e+t}}if(t||(t="/"),e[r])return r;var s=require.modules.path(),a=t||".";if(r.match(/^(?:\.\.?\/|\/)/)){var c=i(s.resolve(a,r))||u(s.resolve(a,r));if(c)return c}var l=o(r,a);if(l)return l;throw new Error("Cannot find module '"+r+"'")}}(),require.alias=function(e,r){var t=require.modules.path(),n=null;try{n=require.resolve(e+"/package.json","/")}catch(o){n=require.resolve(e,"/")}var u=t.dirname(n);Object.keys(require.modules).forEach(function(e){if(e.slice(0,u.length+1)===u+"/"){var t=e.slice(u.length);require.modules[r+t]=require.modules[u+t]}else e===u&&(require.modules[r]=require.modules[u])})},"undefined"==typeof process&&(process={}),process.nextTick||(process.nextTick=function(e){setTimeout(e,0)}),process.title||(process.title="browser"),process.binding||(process.binding=function(e){if("evals"===e)return require("vm");throw new Error("No such module")}),process.cwd||(process.cwd=function(){return"."}),require.modules.path=function(){var e={exports:{}},r=e.exports,t=function(e){return __require(e,".")};return t.resolve=function(){return __require.resolve(name,".")},t.modules=__require.modules,__require.modules.path._cached=e.exports,function(){function e(e,r){for(var t=0,n=e.length;n>=0;n--){var o=e[n];"."==o?e.splice(n,1):".."===o?(e.splice(n,1),t++):t&&(e.splice(n,1),t--)}if(r)for(;t--;t)e.unshift("..");return e}var t=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;r.resolve=function(){for(var r="",t=!1,n=arguments.length;n>=-1&&!t;n--){var o=n>=0?arguments[n]:process.cwd();"string"==typeof o&&o&&(r=o+"/"+r,t="/"===o.charAt(0))}return r=e(r.split("/").filter(function(e){return!!e}),!t).join("/"),(t?"/":"")+r||"."},r.normalize=function(r){var t="/"===r.charAt(0),n="/"===r.slice(-1);return r=e(r.split("/").filter(function(e){return!!e}),!t).join("/"),!r&&!t&&(r="."),r&&n&&(r+="/"),(t?"/":"")+r},r.join=function(){var e=Array.prototype.slice.call(arguments,0);return r.normalize(e.filter(function(e){return e&&"string"==typeof e}).join("/"))},r.dirname=function(e){var r=t.exec(e)[1]||"",n=!1;return r?1===r.length||n&&r.length<=3&&":"===r.charAt(1)?r:r.substring(0,r.length-1):"."},r.basename=function(e,r){var n=t.exec(e)[2]||"";return r&&n.substr(-1*r.length)===r&&(n=n.substr(0,n.length-r.length)),n},r.extname=function(e){return t.exec(e)[3]||""}}.call(e.exports),__require.modules.path._cached=e.exports,e.exports},require.modules["/util.coffee"]=function(){var e={exports:{}},r=e.exports,t=function(e){return __require(e,"/")};return t.resolve=function(){return __require.resolve(name,"/")},t.modules=__require.modules,__require.modules["/util.coffee"]._cached=e.exports,function(){!function(){var e,t,n,o,u,i,s;s=Math.sqrt(3),n=Math.PI/6,o=Math.PI/3,u=Math.sin(n),e=Math.cos(n),i=Math.sin(o),t=Math.cos(o),r.to_xy=function(r,t,n,o){var i,a,c,l,f,p,h,d,v,_,m;return c=s*r/6,i=s*r/3,a=s*r/2,f=0,v=t*i,p=-n*e*i,_=-n*u*i,h=o*e*i,m=-o*u*i,l=f+p+h,d=v+_+m,[l,d]},r.to_uvw=function(e,r,t){var n,u,i,a,c,l,f,p;return 0===r&&0===t?[0,0,0]:(c=s*e/6,n=s*e/3,i=s*e/2,l=Math.floor((n+t)/i),t>0?(u=-1,a=c):(u=1,a=n),f=u*Math.floor((Math.cos(o-Math.atan(r/t))*Math.sqrt(Math.pow(r,2)+Math.pow(t,2))+a)/i),t>0?(u=1,a=n):(u=-1,a=c),p=u*Math.floor((Math.cos(2*o-Math.atan(r/t))*Math.sqrt(Math.pow(r,2)+Math.pow(t,2))+a)/i),[l,f,p])},r.valid_w=function(e,r){return[e-r,e-r+1]}}.call(this)}.call(e.exports),__require.modules["/util.coffee"]._cached=e.exports,e.exports},require.modules["/game.coffee"]=function(){var e={exports:{}},r=e.exports,t=function(e){return __require(e,"/")};return t.resolve=function(){return __require.resolve(name,"/")},t.modules=__require.modules,__require.modules["/game.coffee"]._cached=e.exports,function(){!function(){var e,n,o;e=t("./common").BiromError,n=t("./grid").Grid,o=t("./triangle").Triangle,r.Game=function(){function e(e){this.grid=null!=e?e:new n,this.grid.set(this.red=new o(0,0,0,TRI_TYPE_START)),this.grid.set(new o(0,1,0,TRI_TYPE_START)),this.grid.set(new o(-1,1,0,TRI_TYPE_START)),this.grid.set(new o(-1,1,1,TRI_TYPE_START))}return e.prototype.put=function(e){var r,t,n,o,u,i,s,a,c,l,f,p,h,d,v;if(n=this.grid.deepCopy(),e.validate(n))for(h=e.triangles,s=0,l=h.length;l>s;s++)i=h[s],n.set(i);for(n.fillBorderTriangles(),d=u=n.getPointTriangles(e.triangles),a=0,f=d.length;f>a;a++)o=d[a],n.set(o);for(v=r=n.getCapturedTriangles(e.triangles),c=0,p=v.length;p>c;c++)o=v[c],o.type=TRI_TYPE_COMMON,o.playerId=void 0,n.set(o);if(t=_(e.triangles).first().playerId,n.isEncircledBy(this.red,t))throw{playerWon:t};return this.grid=n.deepCopy(),[e,{triangles:r},{triangles:u}]},e}()}.call(this)}.call(e.exports),__require.modules["/game.coffee"]._cached=e.exports,e.exports},require.modules["/common.coffee"]=function(){var e={exports:{}},r=e.exports,t=function(e){return __require(e,"/")};return t.resolve=function(){return __require.resolve(name,"/")},t.modules=__require.modules,__require.modules["/common.coffee"]._cached=e.exports,function(){!function(){var e;e="undefined"!=typeof global&&null!==global?global:window,e._=t("underscore"),e.TRI_TYPE_START=0,e.TRI_TYPE_COMMON=1,e.TRI_TYPE_POINT=2,e.TRI_TYPE_COUNTER=3,e.TRI_TYPE_BORDER=4,e.EXC_BAD_REQUEST=400,e.EXC_ERROR=500,r.BiromError=function(){function e(e,r){this.message=null!=e?e:"Undefined Error",this.code=null!=r?r:EXC_ERROR}return e.prototype.toString=function(){return""+this.message+" ["+this.code+"]"},e}(),r.bfs=function(e,t){var n,o,u,i,s,a;for(s=[],s.unshift(e),i=1e3,u=0,a=[];!_(s).isEmpty();){if(++u===i)throw new r.BiromError("Endless loop in BFS ("+u+" iterations)",EXC_ERROR);n=s.pop(),a.push(function(){var e,r,u,i;for(u=t(n),i=[],e=0,r=u.length;r>e;e++)o=u[e],i.push(s.unshift(o));return i}())}return a},r.isWithin=function(e,r,t){var n,o,u;return _([e.u,r.u]).min()<=(n=t.u)&&n<=_([e.u,r.u]).max()&&_([e.v,r.v]).min()<=(o=t.v)&&o<=_([e.v,r.v]).max()&&_([e.w,r.w]).min()<=(u=t.w)&&u<=_([e.w,r.w]).max()}}.call(this)}.call(e.exports),__require.modules["/common.coffee"]._cached=e.exports,e.exports},require.modules["/node_modules/underscore/package.json"]=function(){var e={exports:{}},r=(e.exports,function(e){return __require(e,"/node_modules/underscore")});return r.resolve=function(){return __require.resolve(name,"/node_modules/underscore")},r.modules=__require.modules,__require.modules["/node_modules/underscore/package.json"]._cached=e.exports,function(){e.exports={name:"underscore",description:"JavaScript's functional programming helper library.",homepage:"http://documentcloud.github.com/underscore/",keywords:["util","functional","server","client","browser"],author:"Jeremy Ashkenas <jeremy@documentcloud.org>",contributors:[],dependencies:[],repository:{type:"git",url:"git://github.com/documentcloud/underscore.git"},main:"underscore.js",version:"1.1.6"}}.call(e.exports),__require.modules["/node_modules/underscore/package.json"]._cached=e.exports,e.exports},require.modules["/node_modules/underscore/underscore.js"]=function(){var e={exports:{}},r=(e.exports,function(e){return __require(e,"/node_modules/underscore")});return r.resolve=function(){return __require.resolve(name,"/node_modules/underscore")},r.modules=__require.modules,__require.modules["/node_modules/underscore/underscore.js"]._cached=e.exports,function(){!function(){var r=this,t=r._,n={},o=Array.prototype,u=Object.prototype,i=Function.prototype,s=o.slice,a=o.unshift,c=u.toString,l=u.hasOwnProperty,f=o.forEach,p=o.map,h=o.reduce,d=o.reduceRight,v=o.filter,_=o.every,m=o.some,g=o.indexOf,y=o.lastIndexOf,w=Array.isArray,x=Object.keys,E=i.bind,T=function(e){return new O(e)};"undefined"!=typeof e&&e.exports?(e.exports=T,T._=T):r._=T,T.VERSION="1.1.6";var q=T.each=T.forEach=function(e,r,t){if(null!=e)if(f&&e.forEach===f)e.forEach(r,t);else if(T.isNumber(e.length)){for(var o=0,u=e.length;u>o;o++)if(r.call(t,e[o],o,e)===n)return}else for(var i in e)if(l.call(e,i)&&r.call(t,e[i],i,e)===n)return};T.map=function(e,r,t){var n=[];return null==e?n:p&&e.map===p?e.map(r,t):(q(e,function(e,o,u){n[n.length]=r.call(t,e,o,u)}),n)},T.reduce=T.foldl=T.inject=function(e,r,t,n){var o=void 0!==t;if(null==e&&(e=[]),h&&e.reduce===h)return n&&(r=T.bind(r,n)),o?e.reduce(r,t):e.reduce(r);if(q(e,function(e,u,i){o||0!==u?t=r.call(n,t,e,u,i):(t=e,o=!0)}),!o)throw new TypeError("Reduce of empty array with no initial value");return t},T.reduceRight=T.foldr=function(e,r,t,n){if(null==e&&(e=[]),d&&e.reduceRight===d)return n&&(r=T.bind(r,n)),void 0!==t?e.reduceRight(r,t):e.reduceRight(r);var o=(T.isArray(e)?e.slice():T.toArray(e)).reverse();return T.reduce(o,r,t,n)},T.find=T.detect=function(e,r,t){var n;return R(e,function(e,o,u){return r.call(t,e,o,u)?(n=e,!0):void 0}),n},T.filter=T.select=function(e,r,t){var n=[];return null==e?n:v&&e.filter===v?e.filter(r,t):(q(e,function(e,o,u){r.call(t,e,o,u)&&(n[n.length]=e)}),n)},T.reject=function(e,r,t){var n=[];return null==e?n:(q(e,function(e,o,u){r.call(t,e,o,u)||(n[n.length]=e)}),n)},T.every=T.all=function(e,r,t){var o=!0;return null==e?o:_&&e.every===_?e.every(r,t):(q(e,function(e,u,i){return(o=o&&r.call(t,e,u,i))?void 0:n}),o)};var R=T.some=T.any=function(e,r,t){r||(r=T.identity);var o=!1;return null==e?o:m&&e.some===m?e.some(r,t):(q(e,function(e,u,i){return(o=r.call(t,e,u,i))?n:void 0}),o)};T.include=T.contains=function(e,r){var t=!1;return null==e?t:g&&e.indexOf===g?-1!=e.indexOf(r):(R(e,function(e){return(t=e===r)?!0:void 0}),t)},T.invoke=function(e,r){var t=s.call(arguments,2);return T.map(e,function(e){return(r.call?r||e:e[r]).apply(e,t)})},T.pluck=function(e,r){return T.map(e,function(e){return e[r]})},T.max=function(e,r,t){if(!r&&T.isArray(e))return Math.max.apply(Math,e);var n={computed:-1/0};return q(e,function(e,o,u){var i=r?r.call(t,e,o,u):e;i>=n.computed&&(n={value:e,computed:i})}),n.value},T.min=function(e,r,t){if(!r&&T.isArray(e))return Math.min.apply(Math,e);var n={computed:1/0};return q(e,function(e,o,u){var i=r?r.call(t,e,o,u):e;i<n.computed&&(n={value:e,computed:i})}),n.value},T.sortBy=function(e,r,t){return T.pluck(T.map(e,function(e,n,o){return{value:e,criteria:r.call(t,e,n,o)}}).sort(function(e,r){var t=e.criteria,n=r.criteria;return n>t?-1:t>n?1:0}),"value")},T.sortedIndex=function(e,r,t){t||(t=T.identity);for(var n=0,o=e.length;o>n;){var u=n+o>>1;t(e[u])<t(r)?n=u+1:o=u}return n},T.toArray=function(e){return e?e.toArray?e.toArray():T.isArray(e)?e:T.isArguments(e)?s.call(e):T.values(e):[]},T.size=function(e){return T.toArray(e).length},T.first=T.head=function(e,r,t){return null==r||t?e[0]:s.call(e,0,r)},T.rest=T.tail=function(e,r,t){return s.call(e,null==r||t?1:r)},T.last=function(e){return e[e.length-1]},T.compact=function(e){return T.filter(e,function(e){return!!e})},T.flatten=function(e){return T.reduce(e,function(e,r){return T.isArray(r)?e.concat(T.flatten(r)):(e[e.length]=r,e)},[])},T.without=function(e){var r=s.call(arguments,1);return T.filter(e,function(e){return!T.include(r,e)})},T.uniq=T.unique=function(e,r){return T.reduce(e,function(e,t,n){return 0!=n&&(r===!0?T.last(e)==t:T.include(e,t))||(e[e.length]=t),e},[])},T.intersect=function(e){var r=s.call(arguments,1);return T.filter(T.uniq(e),function(e){return T.every(r,function(r){return T.indexOf(r,e)>=0})})},T.zip=function(){for(var e=s.call(arguments),r=T.max(T.pluck(e,"length")),t=Array(r),n=0;r>n;n++)t[n]=T.pluck(e,""+n);return t},T.indexOf=function(e,r,t){if(null==e)return-1;var n,o;if(t)return n=T.sortedIndex(e,r),e[n]===r?n:-1;if(g&&e.indexOf===g)return e.indexOf(r);for(n=0,o=e.length;o>n;n++)if(e[n]===r)return n;return-1},T.lastIndexOf=function(e,r){if(null==e)return-1;if(y&&e.lastIndexOf===y)return e.lastIndexOf(r);for(var t=e.length;t--;)if(e[t]===r)return t;return-1},T.range=function(e,r,t){arguments.length<=1&&(r=e||0,e=0),t=arguments[2]||1;for(var n=Math.max(Math.ceil((r-e)/t),0),o=0,u=Array(n);n>o;)u[o++]=e,e+=t;return u},T.bind=function(e,r){if(e.bind===E&&E)return E.apply(e,s.call(arguments,1));var t=s.call(arguments,2);return function(){return e.apply(r,t.concat(s.call(arguments)))}},T.bindAll=function(e){var r=s.call(arguments,1);return 0==r.length&&(r=T.functions(e)),q(r,function(r){e[r]=T.bind(e[r],e)}),e},T.memoize=function(e,r){var t={};return r||(r=T.identity),function(){var n=r.apply(this,arguments);return l.call(t,n)?t[n]:t[n]=e.apply(this,arguments)}},T.delay=function(e,r){var t=s.call(arguments,2);return setTimeout(function(){return e.apply(e,t)},r)},T.defer=function(e){return T.delay.apply(T,[e,1].concat(s.call(arguments,1)))};var b=function(e,r,t){var n;return function(){var o=this,u=arguments,i=function(){n=null,e.apply(o,u)};t&&clearTimeout(n),(t||!n)&&(n=setTimeout(i,r))}};T.throttle=function(e,r){return b(e,r,!1)},T.debounce=function(e,r){return b(e,r,!0)},T.once=function(e){var r,t=!1;return function(){return t?r:(t=!0,r=e.apply(this,arguments))}},T.wrap=function(e,r){return function(){var t=[e].concat(s.call(arguments));return r.apply(this,t)}},T.compose=function(){var e=s.call(arguments);return function(){for(var r=s.call(arguments),t=e.length-1;t>=0;t--)r=[e[t].apply(this,r)];return r[0]}},T.after=function(e,r){return function(){return--e<1?r.apply(this,arguments):void 0}},T.keys=x||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var r=[];for(var t in e)l.call(e,t)&&(r[r.length]=t);return r},T.values=function(e){return T.map(e,T.identity)},T.functions=T.methods=function(e){return T.filter(T.keys(e),function(r){return T.isFunction(e[r])}).sort()},T.extend=function(e){return q(s.call(arguments,1),function(r){for(var t in r)void 0!==r[t]&&(e[t]=r[t])}),e},T.defaults=function(e){return q(s.call(arguments,1),function(r){for(var t in r)null==e[t]&&(e[t]=r[t])}),e},T.clone=function(e){return T.isArray(e)?e.slice():T.extend({},e)},T.tap=function(e,r){return r(e),e},T.isEqual=function(e,r){if(e===r)return!0;var t=typeof e,n=typeof r;if(t!=n)return!1;if(e==r)return!0;if(!e&&r||e&&!r)return!1;if(e._chain&&(e=e._wrapped),r._chain&&(r=r._wrapped),e.isEqual)return e.isEqual(r);if(T.isDate(e)&&T.isDate(r))return e.getTime()===r.getTime();if(T.isNaN(e)&&T.isNaN(r))return!1;if(T.isRegExp(e)&&T.isRegExp(r))return e.source===r.source&&e.global===r.global&&e.ignoreCase===r.ignoreCase&&e.multiline===r.multiline;if("object"!==t)return!1;if(e.length&&e.length!==r.length)return!1;var o=T.keys(e),u=T.keys(r);if(o.length!=u.length)return!1;for(var i in e)if(!(i in r&&T.isEqual(e[i],r[i])))return!1;return!0},T.isEmpty=function(e){if(T.isArray(e)||T.isString(e))return 0===e.length;for(var r in e)if(l.call(e,r))return!1;return!0},T.isElement=function(e){return!!e&&1==e.nodeType},T.isArray=w||function(e){return"[object Array]"===c.call(e)},T.isArguments=function(e){return!!e&&!!l.call(e,"callee")},T.isFunction=function(e){return!!(e&&e.constructor&&e.call&&e.apply)},T.isString=function(e){return!!(""===e||e&&e.charCodeAt&&e.substr)},T.isNumber=function(e){return!!(0===e||e&&e.toExponential&&e.toFixed)},T.isNaN=function(e){return e!==e},T.isBoolean=function(e){return e===!0||e===!1},T.isDate=function(e){return!!(e&&e.getTimezoneOffset&&e.setUTCFullYear)},T.isRegExp=function(e){return!(!(e&&e.test&&e.exec)||!e.ignoreCase&&e.ignoreCase!==!1)},T.isNull=function(e){return null===e},T.isUndefined=function(e){return void 0===e},T.noConflict=function(){return r._=t,this},T.identity=function(e){return e},T.times=function(e,r,t){for(var n=0;e>n;n++)r.call(t,n)},T.mixin=function(e){q(T.functions(e),function(r){C(r,T[r]=e[r])})};var I=0;T.uniqueId=function(e){var r=I++;return e?e+r:r},T.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},T.template=function(e,r){var t=T.templateSettings,n="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+e.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(t.interpolate,function(e,r){return"',"+r.replace(/\\'/g,"'")+",'"}).replace(t.evaluate||null,function(e,r){return"');"+r.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",o=new Function("obj",n);return r?o(r):o};var O=function(e){this._wrapped=e};T.prototype=O.prototype;var A=function(e,r){return r?T(e).chain():e},C=function(e,r){O.prototype[e]=function(){var e=s.call(arguments);return a.call(e,this._wrapped),A(r.apply(T,e),this._chain)}};T.mixin(T),q(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var r=o[e];O.prototype[e]=function(){return r.apply(this._wrapped,arguments),A(this._wrapped,this._chain)}}),q(["concat","join","slice"],function(e){var r=o[e];O.prototype[e]=function(){return A(r.apply(this._wrapped,arguments),this._chain)}}),O.prototype.chain=function(){return this._chain=!0,this},O.prototype.value=function(){return this._wrapped}}()}.call(e.exports),__require.modules["/node_modules/underscore/underscore.js"]._cached=e.exports,e.exports},require.modules["/grid.coffee"]=function(){var e={exports:{}},r=e.exports,t=function(e){return __require(e,"/")};return t.resolve=function(){return __require.resolve(name,"/")},t.modules=__require.modules,__require.modules["/grid.coffee"]._cached=e.exports,function(){!function(){var e,n,o,u,i=Object.prototype.hasOwnProperty,s=function(e,r){return function(){return e.apply(r,arguments)}},a=Array.prototype.indexOf||function(e){for(var r=0,t=this.length;t>r;r++)if(this[r]===e)return r;return-1};u=t("./common"),n=u.bfs,o=u.isWithin,e=t("./triangle").Triangle,r.Grid=function(){function r(e){this.triangles=null!=e?e:{}}return r.prototype.set=function(r){if(!(r instanceof e))throw new BiromError("Argument is not a triangle",EXC_BAD_REQUEST);return this.triangles[""+r]=r},r.prototype.get=function(e,r,t){return this.triangles[""+e+"/"+r+"/"+t]},r.prototype.getNeighbours=function(e){var r,t;return t=function(){var t,n,o,u;for(o=e.getNeighbourCoords(),u=[],t=0,n=o.length;n>t;t++)r=o[t],u.push(this.get(r.u,r.v,r.w));return u}.call(this),_(t).compact()},r.prototype.getCloseNeighbours=function(e){var r,t;return t=function(){var t,n,o,u;for(o=e.getCloseNeighbourCoords(),u=[],t=0,n=o.length;n>t;t++)r=o[t],u.push(this.get(r.u,r.v,r.w));return u}.call(this),_(t).compact()},r.prototype.getBoundingBox=function(){var e,r,t,n,o,u;return o=_(this.triangles).pluck("u"),u=_(this.triangles).pluck("v"),[{u:e=_(o).max(),v:r=_(u).max(),w:-e-r},{u:t=_(o).min(),v:n=_(u).min(),w:1-t-n}]},r.prototype.deepCopy=function(){var t,n,o,u;n={},u=this.triangles;for(t in u)i.call(u,t)&&(o=u[t],o.type!==TRI_TYPE_BORDER&&(n[t]=new e(o.u,o.v,o.w,o.type,o.playerId)));return new r(n)},r.prototype.fillBorderTriangles=function(){var r,t,u,i,a;return a=this.getBoundingBox(),r=a[0],u=a[1],i=new e(r.u+1,r.v+1,r.w-2,TRI_TYPE_BORDER),t=new e(u.u-1,u.v-1,u.w+2,TRI_TYPE_BORDER),this.set(i),n(i,s(function(r){var n,u,s,a,c,l;for(c=r.getCloseNeighbourCoords(),l=[],s=0,a=c.length;a>s;s++)n=c[s],o(i,t,n)&&null==this.get(n.u,n.v,n.w)&&(u=new e(n.u,n.v,n.w,TRI_TYPE_BORDER),this.set(u),l.push(u));return l},this))},r.prototype.getPointTriangles=function(r){var t,o,u,i,c;if(!_(r).isArray())throw new BiromError("Argument is not an array",EXC_BAD_REQUEST);return t=function(){var e,t,n;for(n=[],e=0,t=r.length;t>e;e++)o=r[e],n.push(""+o.u+"/"+o.v+"/"+o.w);return n}(),u={},i=[],c=_(r).first(),n(c,s(function(r){var n,o,s,l;return s=function(){var e,o,i,s,c;for(i=r.getCloseNeighbourCoords(),c=[],e=0,o=i.length;o>e;e++)n=i[e],(null==this.get(n.u,n.v,n.w)||(s=""+n.u+"/"+n.v+"/"+n.w,a.call(t,s)>=0))&&!u[""+n.u+"/"+n.v+"/"+n.w]&&c.push(n);return c}.call(this),l=function(){var r,t,a;for(a=[],r=0,t=s.length;t>r;r++)n=s[r],u[""+n.u+"/"+n.v+"/"+n.w]=!0,o=this.get(n.u,n.v,n.w),null==o&&(o=new e(n.u,n.v,n.w,TRI_TYPE_POINT,c.playerId),i.push(o)),a.push(o);return a}.call(this)},this)),i},r.prototype.isEncircledBy=function(e,r){var t,o;if(o={},e.type!==TRI_TYPE_START)throw new BiromError("Argument is not a red birom triangle",EXC_BAD_REQUEST);t=!0;try{n(e,s(function(e){var t,n,u,i,s;for(n=[],s=this.getCloseNeighbours(e),u=0,i=s.length;i>u;u++){if(t=s[u],t.type===TRI_TYPE_BORDER)throw"BorderReached";(t.type===TRI_TYPE_START||t.type===TRI_TYPE_COUNTER&&t.playerId!==r)&&!o[""+t.u+"/"+t.v+"/"+t.w]&&n.push(t),o[""+t.u+"/"+t.v+"/"+t.w]=!0}return n},this))}catch(u){if("BorderReached"!==u)throw u;t=!1}return t},r.prototype._getCapturedBranch=function(e){var r,t;t={},r=[],t[""+e.u+"/"+e.v+"/"+e.w]=!0;try{n(e,s(function(e){var n,o,u,i,s;for(r.push(e),o=this.getCloseNeighbours(e),u=[],i=0,s=o.length;s>i;i++){if(n=o[i],n.type===TRI_TYPE_BORDER)throw"EndOfBranch";n.type===TRI_TYPE_COUNTER&&n.playerId===e.playerId&&!t[""+n.u+"/"+n.v+"/"+n.w]&&u.push(n),t[""+n.u+"/"+n.v+"/"+n.w]=!0}return u},this))}catch(o){if("EndOfBranch"!==o)throw o;r=[]}return r},r.prototype.getCapturedTriangles=function(e){var r,t,o,u,i;if(!_(e).isArray())throw new BiromError("Argument is not an array",EXC_BAD_REQUEST);return t=function(){var r,t,n;for(n=[],r=0,t=e.length;t>r;r++)o=e[r],n.push(""+o.u+"/"+o.v+"/"+o.w);return n}(),u={},i=_(e).first(),r=[],n(i,s(function(e){var n,o,s,c,l,f,p;for(c=this.getCloseNeighbours(e),l=function(){var e,r,n,o;for(o=[],e=0,r=c.length;r>e;e++)s=c[e],(s.type===TRI_TYPE_POINT&&s.playerId===i.playerId||(n=""+s.u+"/"+s.v+"/"+s.w,a.call(t,n)>=0))&&!u[""+s.u+"/"+s.v+"/"+s.w]&&(u[""+s.u+"/"+s.v+"/"+s.w]=!0,o.push(s));return o}(),n=function(){var r,t,n;for(n=[],r=0,t=c.length;t>r;r++)s=c[r],s.type===TRI_TYPE_COUNTER&&s.playerId!==e.playerId&&!u[""+s]&&n.push(s);return n}(),f=0,p=n.length;p>f;f++)o=n[f],u[""+o.u+"/"+o.v+"/"+o.w]=!0,r.push(this._getCapturedBranch(o));return l},this)),_(r).flatten()},r}()}.call(this)}.call(e.exports),__require.modules["/grid.coffee"]._cached=e.exports,e.exports},require.modules["/triangle.coffee"]=function(){var e={exports:{}},r=e.exports,t=function(e){return __require(e,"/")};return t.resolve=function(){return __require.resolve(name,"/")},t.modules=__require.modules,__require.modules["/triangle.coffee"]._cached=e.exports,function(){!function(){var e;e=t("./common").BiromError,r.Triangle=function(){function r(r,t,n,o,u){var i;if(this.type=o,this.playerId=u,this.u=parseInt(r),this.v=parseInt(t),this.w=parseInt(n),null==this.u||null==this.v||null==this.w||_.isNaN(this.u)||_.isNaN(this.v)||_.isNaN(this.w))throw new e("Invalid or missing coordinates",EXC_BAD_REQUEST);if(!(0<=(i=this.u+this.v+this.w)&&1>=i))throw new e("Invalid coordinates",EXC_BAD_REQUEST)}return r.prototype.isFacingUp=function(){return 0===this.u+this.v+this.w},r.prototype.isCloseNeighbour=function(e){return 1===Math.abs(this.u-e.u)+Math.abs(this.v-e.v)+Math.abs(this.w-e.w)},r.prototype.getNeighbourCoords=function(){var e,r,t,n,o,u,i,s,a,c,l;for(e=[],a=r=this.u-1,t=this.u+1;t>=r?t>=a:a>=t;t>=r?a++:a--)for(c=n=this.v-1,o=this.v+1;o>=n?o>=c:c>=o;o>=n?c++:c--)for(l=u=this.w-1,i=this.w+1;i>=u?i>=l:l>=i;i>=u?l++:l--)0<=(s=a+c+l)&&1>=s&&(a!==this.u||c!==this.v||l!==this.w)&&e.push({u:a,v:c,w:l});return e},r.prototype.getCloseNeighbourCoords=function(){var e;return e=this.isFacingUp()?1:-1,[{u:this.u+e,v:this.v,w:this.w},{u:this.u,v:this.v+e,w:this.w},{u:this.u,v:this.v,w:this.w+e}]},r.prototype.getVertices=function(){return this.isFacingUp()?[{x:this.u,y:this.v},{x:this.u-1,y:this.v},{x:this.u,y:this.v-1}]:[{x:this.u,y:this.v-1},{x:this.u-1,y:this.v},{x:this.u-1,y:this.v-1}]},r.prototype.toString=function(){return""+this.u+"/"+this.v+"/"+this.w},r}()}.call(this)}.call(e.exports),__require.modules["/triangle.coffee"]._cached=e.exports,e.exports},require.modules["/semirom.coffee"]=function(){var e={exports:{}},r=e.exports,t=function(e){return __require(e,"/")};return t.resolve=function(){return __require.resolve(name,"/")},t.modules=__require.modules,__require.modules["/semirom.coffee"]._cached=e.exports,function(){!function(){var e,n,o,u=Object.prototype.hasOwnProperty,i=function(e,r){function t(){this.constructor=e}for(var n in r)u.call(r,n)&&(e[n]=r[n]);return t.prototype=r.prototype,e.prototype=new t,e.__super__=r.prototype,e};e=t("./common").BiromError,n=t("./move").Move,o=t("./triangle").Triangle,r.Semirom=function(){function r(e,r){this.triangles=[new o(e.u,e.v,e.w,TRI_TYPE_COUNTER,r)]}return i(r,n),r.prototype.validate=function(r){var t,n;if(t=[],n=_(this.triangles).first(),null!=r.get(n.u,n.v,n.w))throw new e("Move overlaps",EXC_BAD_REQUEST);if(0===r.getNeighbours(n).length)throw new e("Move is not connected",EXC_BAD_REQUEST);return!0},r}()}.call(this)}.call(e.exports),__require.modules["/semirom.coffee"]._cached=e.exports,e.exports},require.modules["/move.coffee"]=function(){var e={exports:{}},r=e.exports,t=function(e){return __require(e,"/")};return t.resolve=function(){return __require.resolve(name,"/")},t.modules=__require.modules,__require.modules["/move.coffee"]._cached=e.exports,function(){!function(){var e,n=Object.prototype.hasOwnProperty,o=function(e,r){function t(){this.constructor=e}for(var o in r)n.call(r,o)&&(e[o]=r[o]);return t.prototype=r.prototype,e.prototype=new t,e.__super__=r.prototype,e};e=t("./common").BiromError,r.Move=function(){function e(){e.__super__.constructor.apply(this,arguments)}return o(e,e),e.prototype.getVertices=function(){var e,r,t,n,o,u,i,s,a;for(e=[],u=this.triangles,r=0,n=u.length;n>r;r++)for(s=u[r],i=s.getVertices(),t=0,o=i.length;o>t;t++)a=i[t],_(e).any(function(e){return a.x===e.x&&a.y===e.y})||e.push(a);return e},e}()}.call(this)}.call(e.exports),__require.modules["/move.coffee"]._cached=e.exports,e.exports},require.modules["/standalone.coffee"]=function(){var e={exports:{}},r=(e.exports,function(e){return __require(e,"/")});return r.resolve=function(){return __require.resolve(name,"/")},r.modules=__require.modules,__require.modules["/standalone.coffee"]._cached=e.exports,function(){!function(){var t,n,o,u,i,s=Object.prototype.hasOwnProperty;i=r("./util"),o=i.to_uvw,u=i.to_xy,t=r("./game").Game,n=r("./semirom").Semirom,e.exports=function(){var e,r,i,a,c,l,f,p,h,d,v,_;return a=void 0,f=Raphael("paper","100%","100%"),h=60,d=$("#paper").width(),c=$("#paper").height(),v=d/2,_=c/2,r={},r[TRI_TYPE_COUNTER]={0:"#16A4FD",1:"#F8D200"},r[TRI_TYPE_POINT]={0:"#82126A",1:"#FF6E00"},r[TRI_TYPE_COMMON]={0:"black",1:"black"},l=function(){var r,n,o,u;a=new t,f.clear(),o=a.grid.triangles,u=[];for(r in o)s.call(o,r)&&(n=o[r],u.push(e(h,n.u,n.v,n.w,v,_)));return u},e=function(e,r,t,n,o,i,s){var a,c,l,p,h,d,v,_,m,g;return null==s&&(s="red"),h=Math.sqrt(3)*e/6,a=Math.sqrt(3)*e/3,l=Math.sqrt(3)*e/2,g=u(e,r,t,n),_=g[0],m=g[1],_+=o,m+=i,v=0===(r+t+n)%2,v?(p=["M",_,m-a,"L",_+e/2,m+h,"L",_-e/2,m+h,"Z"],c=Math.round(_)+"/"+Math.round(m+t*h)):(p=["M",_,m+a,"L",_+e/2,m-h,"L",_-e/2,m-h,"Z"],c=Math.round(_)+"/"+Math.round(m+t*h+h)),d=f.path(p),d.attr({fill:s,"stroke-width":.1,stroke:"white"})},i=0,p=!0,$(document).click(function(t){var u,s,c,f,d,m,g,y,w,x,E,T,q,R,b;if(p){console.debug("make move"),x=t.pageX-v-$("#paper").offset().left,E=t.pageY-_-$("#paper").offset().top,R=o(h,x,E),g=R[0],y=R[1],w=R[2],f=i%2,d=new n({u:g,v:y,w:w},f),c=[];try{c=a.put(d),i++}catch(I){if(null==I.playerWon)throw I;alert(""+I.playerWon+" won the game"),l()}for(b=[],T=0,q=c.length;q>T;T++)s=c[T],console.debug(s),b.push(function(){var t,n,o,i,a;for(o=s.triangles,a=[],t=0,n=o.length;n>t;t++)m=o[t],u=null!=(i=r[m.type][m.playerId])?i:"black",console.log(u),a.push(e(h,m.u,m.v,m.w,v,_,u));return a}());return b}}),$(document).mousemove(function(e){var r,t,n,u,i,s;return u=e.pageX-v-$("#paper").offset().left,i=e.pageY-_-$("#paper").offset().top,s=o(h,u,i),r=s[0],t=s[1],n=s[2],$("#xy").html(""+Math.round(u)+", "+Math.round(i)),$("#uvw").html(""+r+" , "+t+", "+n)}),l()}}.call(this)}.call(e.exports),__require.modules["/standalone.coffee"]._cached=e.exports,e.exports};