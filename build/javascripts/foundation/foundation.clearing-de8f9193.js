!function(t,i,e,n){"use strict";Foundation.libs.clearing={name:"clearing",version:"4.0.0",settings:{templates:{viewing:'<a href="#" class="clearing-close">&times;</a><div class="visible-img" style="display: none"><img src="//:0"><p class="clearing-caption"></p><a href="#" class="clearing-main-left"><span></span></a><a href="#" class="clearing-main-right"><span></span></a></div>'},close_selectors:".clearing-close",init:!1,locked:!1},init:function(i,e,n){return this.scope=this.scope||i,Foundation.inherit(this,"set_data get_data remove_data throttle"),"object"==typeof e&&(n=t.extend(!0,this.settings,e)),"string"!=typeof e?(t(this.scope).find("ul[data-clearing]").each(function(){var i=Foundation.libs.clearing,e=t(this),n=n||{},s=i.get_data(e);s||(n.$parent=e.parent(),i.set_data(e,t.extend(!0,i.settings,n)),i.assemble(e.find("li")),i.settings.init||i.events().swipe_events())}),this.settings.init):this[e].call(this,n)},events:function(){var e=this;return t(this.scope).on("click.fndtn.clearing","ul[data-clearing] li",function(i,n,s){var n=n||t(this),s=s||n,a=e.get_data(n.parent());i.preventDefault(),a||e.init(),e.open(t(i.target),n,s),e.update_paddles(s)}).on("click.fndtn.clearing",".clearing-main-right",function(t){this.nav(t,"next")}.bind(this)).on("click.fndtn.clearing",".clearing-main-left",function(t){this.nav(t,"prev")}.bind(this)).on("click.fndtn.clearing",this.settings.close_selectors,function(t){Foundation.libs.clearing.close(t,this)}).on("keydown.fndtn.clearing",function(t){this.keydown(t)}.bind(this)),t(i).on("resize.fndtn.clearing",function(){this.resize()}.bind(this)),this.settings.init=!0,this},swipe_events:function(){var i=this;t(this.scope).on("touchstart.fndtn.clearing",".visible-img",function(i){i.touches||(i=i.originalEvent);var e={start_page_x:i.touches[0].pageX,start_page_y:i.touches[0].pageY,start_time:(new Date).getTime(),delta_x:0,is_scrolling:n};t(this).data("swipe-transition",e),i.stopPropagation()}).on("touchmove.fndtn.clearing",".visible-img",function(e){if(e.touches||(e=e.originalEvent),!(e.touches.length>1||e.scale&&1!==e.scale)){var n=t(this).data("swipe-transition");if("undefined"==typeof n&&(n={}),n.delta_x=e.touches[0].pageX-n.start_page_x,"undefined"==typeof n.is_scrolling&&(n.is_scrolling=!!(n.is_scrolling||Math.abs(n.delta_x)<Math.abs(e.touches[0].pageY-n.start_page_y))),!n.is_scrolling&&!n.active){e.preventDefault();var s=n.delta_x<0?"next":"prev";n.active=!0,i.nav(e,s)}}}).on("touchend.fndtn.clearing",".visible-img",function(i){t(this).data("swipe-transition",{}),i.stopPropagation()})},assemble:function(t){var i=t.parent(),e=this.get_data(i),n=i.detach(),s={grid:'<div class="carousel">'+this.outerHTML(n[0])+"</div>",viewing:e.templates.viewing},a='<div class="clearing-assembled"><div>'+s.viewing+s.grid+"</div></div>";return e.$parent.append(a)},open:function(t,i,e){var n=e.closest(".clearing-assembled"),s=n.find("div").first(),a=s.find(".visible-img"),r=a.find("img").not(t);this.locked()||(r.attr("src",this.load(t)),this.loaded(r,function(){n.addClass("clearing-blackout"),s.addClass("clearing-container"),a.show(),this.fix_height(e).caption(a.find(".clearing-caption"),t).center(r).shift(i,e,function(){e.siblings().removeClass("visible"),e.addClass("visible")})}.bind(this)))},close:function(i,e){i.preventDefault();var n,s,a=function(t){return/blackout/.test(t.selector)?t:t.closest(".clearing-blackout")}(t(e));return e===i.target&&a&&(n=a.find("div").first(),s=n.find(".visible-img"),this.settings.prev_index=0,a.find("ul[data-clearing]").attr("style","").closest(".clearing-blackout").removeClass("clearing-blackout"),n.removeClass("clearing-container"),s.hide()),!1},keydown:function(i){var e=t(".clearing-blackout").find("ul[data-clearing]");39===i.which&&this.go(e,"next"),37===i.which&&this.go(e,"prev"),27===i.which&&t("a.clearing-close").trigger("click")},nav:function(i,e){var n=t(".clearing-blackout").find("ul[data-clearing]");i.preventDefault(),this.go(n,e)},resize:function(){var i=t(".clearing-blackout .visible-img").find("img");i.length&&this.center(i)},fix_height:function(i){var e=i.parent().children(),n=this;return e.each(function(){var i=t(this),e=i.find("img");i.height()>n.outerHeight(e)&&i.addClass("fix-height")}).closest("ul").width(100*e.length+"%"),this},update_paddles:function(t){var i=t.closest(".carousel").siblings(".visible-img");t.next().length?i.find(".clearing-main-right").removeClass("disabled"):i.find(".clearing-main-right").addClass("disabled"),t.prev().length?i.find(".clearing-main-left").removeClass("disabled"):i.find(".clearing-main-left").addClass("disabled")},center:function(t){return t.css({marginLeft:-(this.outerWidth(t)/2),marginTop:-(this.outerHeight(t)/2)}),this},load:function(t){var i=t.parent().attr("href");return this.preload(t),i?i:t.attr("src")},preload:function(t){this.img(t.closest("li").next()).img(t.closest("li").prev())},loaded:function(t,i){function e(){i()}function n(){if(this.one("load",e),/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var t=this.attr("src"),i=t.match(/\?/)?"&":"?";i+="random="+(new Date).getTime(),this.attr("src",t+i)}}return t.attr("src")?(this.complete||4===this.readyState?e():n.call(t),void 0):(e(),void 0)},img:function(t){if(t.length){var i=new Image,e=t.find("a");i.src=e.length?e.attr("href"):t.find("img").attr("src")}return this},caption:function(t,i){var e=i.data("caption");return e?t.text(e).show():t.text("").hide(),this},go:function(t,i){var e=t.find(".visible"),n=e[i]();n.length&&n.find("img").trigger("click",[e,n])},shift:function(t,i,e){var n,s=i.parent(),a=this.settings.prev_index||i.index(),r=this.direction(s,t,i),c=parseInt(s.css("left"),10),l=this.outerWidth(i);i.index()===a||/skip/.test(r)?/skip/.test(r)&&(n=i.index()-this.settings.up_count,this.lock(),n>0?s.animate({left:-(n*l)},300,this.unlock()):s.animate({left:0},300,this.unlock())):/left/.test(r)?(this.lock(),s.animate({left:c+l},300,this.unlock())):/right/.test(r)&&(this.lock(),s.animate({left:c-l},300,this.unlock())),e()},direction:function(i,e,n){var s,a=i.find("li"),r=this.outerWidth(a)+this.outerWidth(a)/4,c=Math.floor(this.outerWidth(t(".clearing-container"))/r)-1,l=a.index(n);return this.settings.up_count=c,s=this.adjacent(this.settings.prev_index,l)?l>c&&l>this.settings.prev_index?"right":l>c-1&&l<=this.settings.prev_index?"left":!1:"skip",this.settings.prev_index=l,s},adjacent:function(t,i){for(var e=i+1;e>=i-1;e--)if(e===t)return!0;return!1},lock:function(){this.settings.locked=!0},unlock:function(){this.settings.locked=!1},locked:function(){return this.settings.locked},outerHTML:function(t){return t.outerHTML||(new XMLSerializer).serializeToString(t)},off:function(){t(this.scope).off(".fndtn.clearing"),t(i).off(".fndtn.clearing"),this.remove_data(),this.settings.init=!1}}}(Foundation.zj,this,this.document);