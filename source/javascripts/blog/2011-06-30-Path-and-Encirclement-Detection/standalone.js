var require=function(a,b){var c=require.resolve(a,b||"/"),d=require.modules[c];if(!d)throw new Error("Failed to resolve module "+a+", tried "+c);var e=d._cached?d._cached:d();return e},__require=require;require.paths=[],require.modules={},require.extensions=[".js",".coffee"],require.resolve=function(){var a=["assert","events","fs","path","vm"].reduce(function(a,b){a[b]=!0;return a},{});return function(b,c){function k(a){var b;a==="/"?b=[""]:b=d.normalize(a).split(/\/+/);var c=[];for(var e=b.length-1;e>=0;e--){if(b[e]==="node_modules")continue;var f=b.slice(0,e+1).join("/")+"/node_modules";c.push(f)}return c}function j(a,b){var c=k(b);for(var d=0;d<c.length;d++){var e=c[d],f=h(e+"/"+a);if(f)return f;var g=i(e+"/"+a);if(g)return g}var f=h(a);if(f)return f}function i(a){a=a.replace(/\/+$/,"");var b=a+"/package.json";if(require.modules[b]){var c=require.modules[b](),e=c.browserify;if(typeof e=="object"&&e.main){var f=h(d.resolve(a,e.main));if(f)return f}else if(typeof e=="string"){var f=h(d.resolve(a,e));if(f)return f}else if(c.main){var f=h(d.resolve(a,c.main));if(f)return f}}return h(a+"/index")}function h(a){if(require.modules[a])return a;for(var b=0;b<require.extensions.length;b++){var c=require.extensions[b];if(require.modules[a+c])return a+c}}c||(c="/");if(a[b])return b;var d=require.modules.path(),e=c||".";if(b.match(/^(?:\.\.?\/|\/)/)){var f=h(d.resolve(e,b))||i(d.resolve(e,b));if(f)return f}var g=j(b,e);if(g)return g;throw new Error("Cannot find module '"+b+"'")}}(),require.alias=function(a,b){var c=require.modules.path(),d=null;try{d=require.resolve(a+"/package.json","/")}catch(e){d=require.resolve(a,"/")}var f=c.dirname(d);Object.keys(require.modules).forEach(function(a){if(a.slice(0,f.length+1)===f+"/"){var c=a.slice(f.length);require.modules[b+c]=require.modules[f+c]}else a===f&&(require.modules[b]=require.modules[f])})},typeof process=="undefined"&&(process={}),process.nextTick||(process.nextTick=function(a){setTimeout(a,0)}),process.title||(process.title="browser"),process.binding||(process.binding=function(a){if(a==="evals")return require("vm");throw new Error("No such module")}),process.cwd||(process.cwd=function(){return"."}),require.modules.path=function(){var a={exports:{}},b=a.exports,c=".",d="path",e=function(a){return __require(a,".")};e.resolve=function(a){return __require.resolve(name,".")},e.modules=__require.modules,__require.modules.path._cached=a.exports,function(){function a(a,b){var c=0;for(var d=a.length;d>=0;d--){var e=a[d];e=="."?a.splice(d,1):e===".."?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a}var c=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;b.resolve=function(){var b="",c=!1;for(var d=arguments.length;d>=-1&&!c;d--){var e=d>=0?arguments[d]:process.cwd();if(typeof e!="string"||!e)continue;b=e+"/"+b,c=e.charAt(0)==="/"}b=a(b.split("/").filter(function(a){return!!a}),!c).join("/");return(c?"/":"")+b||"."},b.normalize=function(b){var c=b.charAt(0)==="/",d=b.slice(-1)==="/";b=a(b.split("/").filter(function(a){return!!a}),!c).join("/"),!b&&!c&&(b="."),b&&d&&(b+="/");return(c?"/":"")+b},b.join=function(){var a=Array.prototype.slice.call(arguments,0);return b.normalize(a.filter(function(a,b){return a&&typeof a=="string"}).join("/"))},b.dirname=function(a){var b=c.exec(a)[1]||"",d=!1;return b?b.length===1||d&&b.length<=3&&b.charAt(1)===":"?b:b.substring(0,b.length-1):"."},b.basename=function(a,b){var d=c.exec(a)[2]||"";b&&d.substr(-1*b.length)===b&&(d=d.substr(0,d.length-b.length));return d},b.extname=function(a){return c.exec(a)[3]||""}}.call(a.exports),__require.modules.path._cached=a.exports;return a.exports},require.modules["/util.coffee"]=function(){var a={exports:{}},b=a.exports,c="/",d="/util.coffee",e=function(a){return __require(a,"/")};e.resolve=function(a){return __require.resolve(name,"/")},e.modules=__require.modules,__require.modules["/util.coffee"]._cached=a.exports,function(){(function(){var a,c,d,e,f,g,h;h=Math.sqrt(3),d=Math.PI/6,e=Math.PI/3,f=Math.sin(d),a=Math.cos(d),g=Math.sin(e),c=Math.cos(e),b.to_xy=function(b,c,d,e){var g,i,j,k,l,m,n,o,p,q,r;j=h*b/6,g=h*b/3,i=h*b/2,l=0,p=c*g,m=-d*a*g,q=-d*f*g,n=e*a*g,r=-e*f*g,k=l+m+n,o=p+q+r;return[k,o]},b.to_uvw=function(a,b,c){var d,f,g,i,j,k,l,m;if(b===0&&c===0)return[0,0,0];j=h*a/6,d=h*a/3,g=h*a/2,k=Math.floor((d+c)/g),c>0?(f=-1,i=j):(f=1,i=d),l=f*Math.floor((Math.cos(e-Math.atan(b/c))*Math.sqrt(Math.pow(b,2)+Math.pow(c,2))+i)/g),c>0?(f=1,i=d):(f=-1,i=j),m=f*Math.floor((Math.cos(2*e-Math.atan(b/c))*Math.sqrt(Math.pow(b,2)+Math.pow(c,2))+i)/g);return[k,l,m]},b.valid_w=function(a,b){return[a-b,a-b+1]}}).call(this)}.call(a.exports),__require.modules["/util.coffee"]._cached=a.exports;return a.exports},require.modules["/game.coffee"]=function(){var a={exports:{}},b=a.exports,c="/",d="/game.coffee",e=function(a){return __require(a,"/")};e.resolve=function(a){return __require.resolve(name,"/")},e.modules=__require.modules,__require.modules["/game.coffee"]._cached=a.exports,function(){(function(){var a,c,d;a=e("./common").BiromError,c=e("./grid").Grid,d=e("./triangle").Triangle,b.Game=function(){function a(a){this.grid=a!=null?a:new c,this.grid.set(this.red=new d(0,0,0,TRI_TYPE_START)),this.grid.set(new d(0,1,0,TRI_TYPE_START)),this.grid.set(new d(-1,1,0,TRI_TYPE_START)),this.grid.set(new d(-1,1,1,TRI_TYPE_START))}a.prototype.put=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;d=this.grid.deepCopy();if(a.validate(d)){n=a.triangles;for(h=0,k=n.length;h<k;h++)g=n[h],d.set(g)}d.fillBorderTriangles(),o=f=d.getPointTriangles(a.triangles);for(i=0,l=o.length;i<l;i++)e=o[i],d.set(e);p=b=d.getCapturedTriangles(a.triangles);for(j=0,m=p.length;j<m;j++)e=p[j],e.type=TRI_TYPE_COMMON,e.playerId=void 0,d.set(e);c=_(a.triangles).first().playerId;if(d.isEncircledBy(this.red,c))throw{playerWon:c};this.grid=d.deepCopy();return[a,{triangles:b},{triangles:f}]};return a}()}).call(this)}.call(a.exports),__require.modules["/game.coffee"]._cached=a.exports;return a.exports},require.modules["/common.coffee"]=function(){var a={exports:{}},b=a.exports,c="/",d="/common.coffee",e=function(a){return __require(a,"/")};e.resolve=function(a){return __require.resolve(name,"/")},e.modules=__require.modules,__require.modules["/common.coffee"]._cached=a.exports,function(){(function(){var a;a=typeof global!="undefined"&&global!==null?global:window,a._=e("underscore"),a.TRI_TYPE_START=0,a.TRI_TYPE_COMMON=1,a.TRI_TYPE_POINT=2,a.TRI_TYPE_COUNTER=3,a.TRI_TYPE_BORDER=4,a.EXC_BAD_REQUEST=400,a.EXC_ERROR=500,b.BiromError=function(){function a(a,b){this.message=a!=null?a:"Undefined Error",this.code=b!=null?b:EXC_ERROR}a.prototype.toString=function(){return""+this.message+" ["+this.code+"]"};return a}(),b.bfs=function(a,c){var d,e,f,g,h,i;h=[],h.unshift(a),g=1e3,f=0,i=[];while(!_(h).isEmpty()){if(++f===g)throw new b.BiromError("Endless loop in BFS ("+f+" iterations)",EXC_ERROR);d=h.pop(),i.push(function(){var a,b,f,g;f=c(d),g=[];for(a=0,b=f.length;a<b;a++)e=f[a],g.push(h.unshift(e));return g}())}return i},b.isWithin=function(a,b,c){var d,e,f;return _([a.u,b.u]).min()<=(d=c.u)&&d<=_([a.u,b.u]).max()&&_([a.v,b.v]).min()<=(e=c.v)&&e<=_([a.v,b.v]).max()&&_([a.w,b.w]).min()<=(f=c.w)&&f<=_([a.w,b.w]).max()}}).call(this)}.call(a.exports),__require.modules["/common.coffee"]._cached=a.exports;return a.exports},require.modules["/node_modules/underscore/package.json"]=function(){var a={exports:{}},b=a.exports,c="/node_modules/underscore",d="/node_modules/underscore/package.json",e=function(a){return __require(a,"/node_modules/underscore")};e.resolve=function(a){return __require.resolve(name,"/node_modules/underscore")},e.modules=__require.modules,__require.modules["/node_modules/underscore/package.json"]._cached=a.exports,function(){a.exports={name:"underscore",description:"JavaScript's functional programming helper library.",homepage:"http://documentcloud.github.com/underscore/",keywords:["util","functional","server","client","browser"],author:"Jeremy Ashkenas <jeremy@documentcloud.org>",contributors:[],dependencies:[],repository:{type:"git",url:"git://github.com/documentcloud/underscore.git"},main:"underscore.js",version:"1.1.6"}}.call(a.exports),__require.modules["/node_modules/underscore/package.json"]._cached=a.exports;return a.exports},require.modules["/node_modules/underscore/underscore.js"]=function(){var a={exports:{}},b=a.exports,c="/node_modules/underscore",d="/node_modules/underscore/underscore.js",e=function(a){return __require(a,"/node_modules/underscore")};e.resolve=function(a){return __require.resolve(name,"/node_modules/underscore")},e.modules=__require.modules,__require.modules["/node_modules/underscore/underscore.js"]._cached=a.exports,function(){(function(){var b=this,c=b._,d={},e=Array.prototype,f=Object.prototype,g=Function.prototype,h=e.slice,i=e.unshift,j=f.toString,k=f.hasOwnProperty,l=e.forEach,m=e.map,n=e.reduce,o=e.reduceRight,p=e.filter,q=e.every,r=e.some,s=e.indexOf,t=e.lastIndexOf,u=Array.isArray,v=Object.keys,w=g.bind,x=function(a){return new C(a)};typeof a!="undefined"&&a.exports?(a.exports=x,x._=x):b._=x,x.VERSION="1.1.6";var y=x.each=x.forEach=function(a,b,c){if(a!=null)if(l&&a.forEach===l)a.forEach(b,c);else if(x.isNumber(a.length)){for(var e=0,f=a.length;e<f;e++)if(b.call(c,a[e],e,a)===d)return}else for(var g in a)if(k.call(a,g)&&b.call(c,a[g],g,a)===d)return};x.map=function(a,b,c){var d=[];if(a==null)return d;if(m&&a.map===m)return a.map(b,c);y(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)});return d},x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=c!==void 0;a==null&&(a=[]);if(n&&a.reduce===n){d&&(b=x.bind(b,d));return e?a.reduce(b,c):a.reduce(b)}y(a,function(a,f,g){!e&&f===0?(c=a,e=!0):c=b.call(d,c,a,f,g)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return c},x.reduceRight=x.foldr=function(a,b,c,d){a==null&&(a=[]);if(o&&a.reduceRight===o){d&&(b=x.bind(b,d));return c!==void 0?a.reduceRight(b,c):a.reduceRight(b)}var e=(x.isArray(a)?a.slice():x.toArray(a)).reverse();return x.reduce(e,b,c,d)},x.find=x.detect=function(a,b,c){var d;z(a,function(a,e,f){if(b.call(c,a,e,f)){d=a;return!0}});return d},x.filter=x.select=function(a,b,c){var d=[];if(a==null)return d;if(p&&a.filter===p)return a.filter(b,c);y(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)});return d},x.reject=function(a,b,c){var d=[];if(a==null)return d;y(a,function(a,e,f){b.call(c,a,e,f)||(d[d.length]=a)});return d},x.every=x.all=function(a,b,c){var e=!0;if(a==null)return e;if(q&&a.every===q)return a.every(b,c);y(a,function(a,f,g){if(!(e=e&&b.call(c,a,f,g)))return d});return e};var z=x.some=x.any=function(a,b,c){b||(b=x.identity);var e=!1;if(a==null)return e;if(r&&a.some===r)return a.some(b,c);y(a,function(a,f,g){if(e=b.call(c,a,f,g))return d});return e};x.include=x.contains=function(a,b){var c=!1;if(a==null)return c;if(s&&a.indexOf===s)return a.indexOf(b)!=-1;z(a,function(a){if(c=a===b)return!0});return c},x.invoke=function(a,b){var c=h.call(arguments,2);return x.map(a,function(a){return(b.call?b||a:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,function(a){return a[b]})},x.max=function(a,b,c){if(!b&&x.isArray(a))return Math.max.apply(Math,a);var d={computed:-Infinity};y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})});return d.value},x.min=function(a,b,c){if(!b&&x.isArray(a))return Math.min.apply(Math,a);var d={computed:Infinity};y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})});return d.value},x.sortBy=function(a,b,c){return x.pluck(x.map(a,function(a,d,e){return{value:a,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0}),"value")},x.sortedIndex=function(a,b,c){c||(c=x.identity);var d=0,e=a.length;while(d<e){var f=d+e>>1;c(a[f])<c(b)?d=f+1:e=f}return d},x.toArray=function(a){if(!a)return[];if(a.toArray)return a.toArray();if(x.isArray(a))return a;if(x.isArguments(a))return h.call(a);return x.values(a)},x.size=function(a){return x.toArray(a).length},x.first=x.head=function(a,b,c){return b!=null&&!c?h.call(a,0,b):a[0]},x.rest=x.tail=function(a,b,c){return h.call(a,b==null||c?1:b)},x.last=function(a){return a[a.length-1]},x.compact=function(a){return x.filter(a,function(a){return!!a})},x.flatten=function(a){return x.reduce(a,function(a,b){if(x.isArray(b))return a.concat(x.flatten(b));a[a.length]=b;return a},[])},x.without=function(a){var b=h.call(arguments,1);return x.filter(a,function(a){return!x.include(b,a)})},x.uniq=x.unique=function(a,b){return x.reduce(a,function(a,c,d){if(0==d||(b===!0?x.last(a)!=c:!x.include(a,c)))a[a.length]=c;return a},[])},x.intersect=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.indexOf(b,a)>=0})})},x.zip=function(){var a=h.call(arguments),b=x.max(x.pluck(a,"length")),c=Array(b);for(var d=0;d<b;d++)c[d]=x.pluck(a,""+d);return c},x.indexOf=function(a,b,c){if(a==null)return-1;var d,e;if(c){d=x.sortedIndex(a,b);return a[d]===b?d:-1}if(s&&a.indexOf===s)return a.indexOf(b);for(d=0,e=a.length;d<e;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b){if(a==null)return-1;if(t&&a.lastIndexOf===t)return a.lastIndexOf(b);var c=a.length;while(c--)if(a[c]===b)return c;return-1},x.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=Array(d);while(e<d)f[e++]=a,a+=c;return f},x.bind=function(a,b){if(a.bind===w&&w)return w.apply(a,h.call(arguments,1));var c=h.call(arguments,2);return function(){return a.apply(b,c.concat(h.call(arguments)))}},x.bindAll=function(a){var b=h.call(arguments,1);b.length==0&&(b=x.functions(a)),y(b,function(b){a[b]=x.bind(a[b],a)});return a},x.memoize=function(a,b){var c={};b||(b=x.identity);return function(){var d=b.apply(this,arguments);return k.call(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(a,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))};var A=function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,a.apply(e,f)};c&&clearTimeout(d);if(c||!d)d=setTimeout(g,b)}};x.throttle=function(a,b){return A(a,b,!1)},x.debounce=function(a,b){return A(a,b,!0)},x.once=function(a){var b=!1,c;return function(){if(b)return c;b=!0;return c=a.apply(this,arguments)}},x.wrap=function(a,b){return function(){var c=[a].concat(h.call(arguments));return b.apply(this,c)}},x.compose=function(){var a=h.call(arguments);return function(){var b=h.call(arguments);for(var c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return function(){if(--a<1)return b.apply(this,arguments)}},x.keys=v||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)k.call(a,c)&&(b[b.length]=c);return b},x.values=function(a){return x.map(a,x.identity)},x.functions=x.methods=function(a){return x.filter(x.keys(a),function(b){return x.isFunction(a[b])}).sort()},x.extend=function(a){y(h.call(arguments,1),function(b){for(var c in b)b[c]!==void 0&&(a[c]=b[c])});return a},x.defaults=function(a){y(h.call(arguments,1),function(b){for(var c in b)a[c]==null&&(a[c]=b[c])});return a},x.clone=function(a){return x.isArray(a)?a.slice():x.extend({},a)},x.tap=function(a,b){b(a);return a},x.isEqual=function(a,b){if(a===b)return!0;var c=typeof a,d=typeof b;if(c!=d)return!1;if(a==b)return!0;if(!a&&b||a&&!b)return!1;a._chain&&(a=a._wrapped),b._chain&&(b=b._wrapped);if(a.isEqual)return a.isEqual(b);if(x.isDate(a)&&x.isDate(b))return a.getTime()===b.getTime();if(x.isNaN(a)&&x.isNaN(b))return!1;if(x.isRegExp(a)&&x.isRegExp(b))return a.source===b.source&&a.global===b.global&&a.ignoreCase===b.ignoreCase&&a.multiline===b.multiline;if(c!=="object")return!1;if(a.length&&a.length!==b.length)return!1;var e=x.keys(a),f=x.keys(b);if(e.length!=f.length)return!1;for(var g in a)if(!(g in b)||!x.isEqual(a[g],b[g]))return!1;return!0},x.isEmpty=function(a){if(x.isArray(a)||x.isString(a))return a.length===0;for(var b in a)if(k.call(a,b))return!1;return!0},x.isElement=function(a){return!!a&&a.nodeType==1},x.isArray=u||function(a){return j.call(a)==="[object Array]"},x.isArguments=function(a){return!!a&&!!k.call(a,"callee")},x.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},x.isString=function(a){return!!(a===""||a&&a.charCodeAt&&a.substr)},x.isNumber=function(a){return!!(a===0||a&&a.toExponential&&a.toFixed)},x.isNaN=function(a){return a!==a},x.isBoolean=function(a){return a===!0||a===!1},x.isDate=function(a){return!!(a&&a.getTimezoneOffset&&a.setUTCFullYear)},x.isRegExp=function(a){return!(!(a&&a.test&&a.exec)||!a.ignoreCase&&a.ignoreCase!==!1)},x.isNull=function(a){return a===null},x.isUndefined=function(a){return a===void 0},x.noConflict=function(){b._=c;return this},x.identity=function(a){return a},x.times=function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)},x.mixin=function(a){y(x.functions(a),function(b){E(b,x[b]=a[b])})};var B=0;x.uniqueId=function(a){var b=B++;return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},x.template=function(a,b){var c=x.templateSettings,d="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+a.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(c.interpolate,function(a,b){return"',"+b.replace(/\\'/g,"'")+",'"}).replace(c.evaluate||null,function(a,b){return"');"+b.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",e=new Function("obj",d);return b?e(b):e};var C=function(a){this._wrapped=a};x.prototype=C.prototype;var D=function(a,b){return b?x(a).chain():a},E=function(a,b){C.prototype[a]=function(){var a=h.call(arguments);i.call(a,this._wrapped);return D(b.apply(x,a),this._chain)}};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=e[a];C.prototype[a]=function(){b.apply(this._wrapped,arguments);return D(this._wrapped,this._chain)}}),y(["concat","join","slice"],function(a){var b=e[a];C.prototype[a]=function(){return D(b.apply(this._wrapped,arguments),this._chain)}}),C.prototype.chain=function(){this._chain=!0;return this},C.prototype.value=function(){return this._wrapped}})()}.call(a.exports),__require.modules["/node_modules/underscore/underscore.js"]._cached=a.exports;return a.exports},require.modules["/grid.coffee"]=function(){var a={exports:{}},b=a.exports,c="/",d="/grid.coffee",e=function(a){return __require(a,"/")};e.resolve=function(a){return __require.resolve(name,"/")},e.modules=__require.modules,__require.modules["/grid.coffee"]._cached=a.exports,function(){(function(){var a,c,d,f,g=Object.prototype.hasOwnProperty,h=function(a,b){return function(){return a.apply(b,arguments)}},i=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1};f=e("./common"),c=f.bfs,d=f.isWithin,a=e("./triangle").Triangle,b.Grid=function(){function b(a){this.triangles=a!=null?a:{}}b.prototype.set=function(b){if(!(b instanceof a))throw new BiromError("Argument is not a triangle",EXC_BAD_REQUEST);return this.triangles[""+b]=b},b.prototype.get=function(a,b,c){return this.triangles[""+a+"/"+b+"/"+c]},b.prototype.getNeighbours=function(a){var b,c;c=function(){var c,d,e,f;e=a.getNeighbourCoords(),f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(this.get(b.u,b.v,b.w));return f}.call(this);return _(c).compact()},b.prototype.getCloseNeighbours=function(a){var b,c;c=function(){var c,d,e,f;e=a.getCloseNeighbourCoords(),f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(this.get(b.u,b.v,b.w));return f}.call(this);return _(c).compact()},b.prototype.getBoundingBox=function(){var a,b,c,d,e,f;e=_(this.triangles).pluck("u"),f=_(this.triangles).pluck("v");return[{u:a=_(e).max(),v:b=_(f).max(),w:-a-b},{u:c=_(e).min(),v:d=_(f).min(),w:1-c-d}]},b.prototype.deepCopy=function(){var c,d,e,f;d={},f=this.triangles;for(c in f){if(!g.call(f,c))continue;e=f[c],e.type!==TRI_TYPE_BORDER&&(d[c]=new a(e.u,e.v,e.w,e.type,e.playerId))}return new b(d)},b.prototype.fillBorderTriangles=function(){var b,e,f,g,i;i=this.getBoundingBox(),b=i[0],f=i[1],g=new a(b.u+1,b.v+1,b.w-2,TRI_TYPE_BORDER),e=new a(f.u-1,f.v-1,f.w+2,TRI_TYPE_BORDER),this.set(g);return c(g,h(function(b){var c,f,h,i,j,k;j=b.getCloseNeighbourCoords(),k=[];for(h=0,i=j.length;h<i;h++)c=j[h],d(g,e,c)&&this.get(c.u,c.v,c.w)==null&&(f=new a(c.u,c.v,c.w,TRI_TYPE_BORDER),this.set(f),k.push(f));return k},this))},b.prototype.getPointTriangles=function(b){var d,e,f,g,j;if(!_(b).isArray())throw new BiromError("Argument is not an array",EXC_BAD_REQUEST);d=function(){var a,c,d;d=[];for(a=0,c=b.length;a<c;a++)e=b[a],d.push(""+e.u+"/"+e.v+"/"+e.w);return d}(),f={},g=[],j=_(b).first(),c(j,h(function(b){var c,e,h,k;h=function(){var a,e,g,h,j;g=b.getCloseNeighbourCoords(),j=[];for(a=0,e=g.length;a<e;a++)c=g[a],(this.get(c.u,c.v,c.w)==null||(h=""+c.u+"/"+c.v+"/"+c.w,i.call(d,h)>=0))&&!f[""+c.u+"/"+c.v+"/"+c.w]&&j.push(c);return j}.call(this),k=function(){var b,d,i;i=[];for(b=0,d=h.length;b<d;b++)c=h[b],f[""+c.u+"/"+c.v+"/"+c.w]=!0,e=this.get(c.u,c.v,c.w),e==null&&(e=new a(c.u,c.v,c.w,TRI_TYPE_POINT,j.playerId),g.push(e)),i.push(e);return i}.call(this);return k},this));return g},b.prototype.isEncircledBy=function(a,b){var d,e;e={};if(a.type!==TRI_TYPE_START)throw new BiromError("Argument is not a red birom triangle",EXC_BAD_REQUEST);d=!0;try{c(a,h(function(a){var c,d,f,g,h;d=[],h=this.getCloseNeighbours(a);for(f=0,g=h.length;f<g;f++){c=h[f];if(c.type===TRI_TYPE_BORDER)throw"BorderReached";(c.type===TRI_TYPE_START||c.type===TRI_TYPE_COUNTER&&c.playerId!==b)&&!e[""+c.u+"/"+c.v+"/"+c.w]&&d.push(c),e[""+c.u+"/"+c.v+"/"+c.w]=!0}return d},this))}catch(f){if(f==="BorderReached")d=!1;else throw f}return d},b.prototype._getCapturedBranch=function(a){var b,d;d={},b=[],d[""+a.u+"/"+a.v+"/"+a.w]=!0;try{c(a,h(function(a){var c,e,f,g,h;b.push(a),e=this.getCloseNeighbours(a),f=[];for(g=0,h=e.length;g<h;g++){c=e[g];if(c.type===TRI_TYPE_BORDER)throw"EndOfBranch";c.type===TRI_TYPE_COUNTER&&c.playerId===a.playerId&&!d[""+c.u+"/"+c.v+"/"+c.w]&&f.push(c),d[""+c.u+"/"+c.v+"/"+c.w]=!0}return f},this))}catch(e){if(e==="EndOfBranch")b=[];else throw e}return b},b.prototype.getCapturedTriangles=function(a){var b,d,e,f,g;if(!_(a).isArray())throw new BiromError("Argument is not an array",EXC_BAD_REQUEST);d=function(){var b,c,d;d=[];for(b=0,c=a.length;b<c;b++)e=a[b],d.push(""+e.u+"/"+e.v+"/"+e.w);return d}(),f={},g=_(a).first(),b=[],c(g,h(function(a){var c,e,h,j,k,l,m;j=this.getCloseNeighbours(a),k=function(){var a,b,c,e;e=[];for(a=0,b=j.length;a<b;a++)h=j[a],(h.type===TRI_TYPE_POINT&&h.playerId===g.playerId||(c=""+h.u+"/"+h.v+"/"+h.w,i.call(d,c)>=0))&&!f[""+h.u+"/"+h.v+"/"+h.w]&&(f[""+h.u+"/"+h.v+"/"+h.w]=!0,e.push(h));return e}(),c=function(){var b,c,d;d=[];for(b=0,c=j.length;b<c;b++)h=j[b],h.type===TRI_TYPE_COUNTER&&h.playerId!==a.playerId&&!f[""+h]&&d.push(h);return d}();for(l=0,m=c.length;l<m;l++)e=c[l],f[""+e.u+"/"+e.v+"/"+e.w]=!0,b.push(this._getCapturedBranch(e));return k},this));return _(b).flatten()};return b}()}).call(this)}.call(a.exports),__require.modules["/grid.coffee"]._cached=a.exports;return a.exports},require.modules["/triangle.coffee"]=function(){var a={exports:{}},b=a.exports,c="/",d="/triangle.coffee",e=function(a){return __require(a,"/")};e.resolve=function(a){return __require.resolve(name,"/")},e.modules=__require.modules,__require.modules["/triangle.coffee"]._cached=a.exports,function(){(function(){var a;a=e("./common").BiromError,b.Triangle=function(){function b(b,c,d,e,f){var g;this.type=e,this.playerId=f,this.u=parseInt(b),this.v=parseInt(c),this.w=parseInt(d);if(this.u==null||this.v==null||this.w==null||!!(_.isNaN(this.u)||_.isNaN(this.v)||_.isNaN(this.w)))throw new a("Invalid or missing coordinates",EXC_BAD_REQUEST);if(!(0<=(g=this.u+this.v+this.w)&&g<=1))throw new a("Invalid coordinates",EXC_BAD_REQUEST)}b.prototype.isFacingUp=function(){return this.u+this.v+this.w===0},b.prototype.isCloseNeighbour=function(a){return Math.abs(this.u-a.u)+Math.abs(this.v-a.v)+Math.abs(this.w-a.w)===1},b.prototype.getNeighbourCoords=function(){var a,b,c,d,e,f,g,h,i,j,k;a=[];for(i=b=this.u-1,c=this.u+1;b<=c?i<=c:i>=c;b<=c?i++:i--)for(j=d=this.v-1,e=this.v+1;d<=e?j<=e:j>=e;d<=e?j++:j--)for(k=f=this.w-1,g=this.w+1;f<=g?k<=g:k>=g;f<=g?k++:k--)0<=(h=i+j+k)&&h<=1&&(i!==this.u||j!==this.v||k!==this.w)&&a.push({u:i,v:j,w:k});return a},b.prototype.getCloseNeighbourCoords=function(){var a;a=this.isFacingUp()?1:-1;return[{u:this.u+a,v:this.v,w:this.w},{u:this.u,v:this.v+a,w:this.w},{u:this.u,v:this.v,w:this.w+a}]},b.prototype.getVertices=function(){return this.isFacingUp()?[{x:this.u,y:this.v},{x:this.u-1,y:this.v},{x:this.u,y:this.v-1}]:[{x:this.u,y:this.v-1},{x:this.u-1,y:this.v},{x:this.u-1,y:this.v-1}]},b.prototype.toString=function(){return""+this.u+"/"+this.v+"/"+this.w};return b}()}).call(this)}.call(a.exports),__require.modules["/triangle.coffee"]._cached=a.exports;return a.exports},require.modules["/semirom.coffee"]=function(){var a={exports:{}},b=a.exports,c="/",d="/semirom.coffee",e=function(a){return __require(a,"/")};e.resolve=function(a){return __require.resolve(name,"/")},e.modules=__require.modules,__require.modules["/semirom.coffee"]._cached=a.exports,function(){(function(){var a,c,d,f=Object.prototype.hasOwnProperty,g=function(a,b){function d(){this.constructor=a}for(var c in b)f.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype;return a};a=e("./common").BiromError,c=e("./move").Move,d=e("./triangle").Triangle,b.Semirom=function(){function b(a,b){this.triangles=[new d(a.u,a.v,a.w,TRI_TYPE_COUNTER,b)]}g(b,c),b.prototype.validate=function(b){var c,d;c=[],d=_(this.triangles).first();if(b.get(d.u,d.v,d.w)!=null)throw new a("Move overlaps",EXC_BAD_REQUEST);if(b.getNeighbours(d).length===0)throw new a("Move is not connected",EXC_BAD_REQUEST);return!0};return b}()}).call(this)}.call(a.exports),__require.modules["/semirom.coffee"]._cached=a.exports;return a.exports},require.modules["/move.coffee"]=function(){var a={exports:{}},b=a.exports,c="/",d="/move.coffee",e=function(a){return __require(a,"/")};e.resolve=function(a){return __require.resolve(name,"/")},e.modules=__require.modules,__require.modules["/move.coffee"]._cached=a.exports,function(){(function(){var a,c=Object.prototype.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype;return a};a=e("./common").BiromError,b.Move=function(){function a(){a.__super__.constructor.apply(this,arguments)}d(a,a),a.prototype.getVertices=function(){var a,b,c,d,e,f,g,h,i;a=[],f=this.triangles;for(b=0,d=f.length;b<d;b++){h=f[b],g=h.getVertices();for(c=0,e=g.length;c<e;c++)i=g[c],_(a).any(function(a){return i.x===a.x&&i.y===a.y})||a.push(i)}return a};return a}()}).call(this)}.call(a.exports),__require.modules["/move.coffee"]._cached=a.exports;return a.exports},require.modules["/standalone.coffee"]=function(){var a={exports:{}},b=a.exports,c="/",d="/standalone.coffee",e=function(a){return __require(a,"/")};e.resolve=function(a){return __require.resolve(name,"/")},e.modules=__require.modules,__require.modules["/standalone.coffee"]._cached=a.exports,function(){(function(){var b,c,d,f,g,h=Object.prototype.hasOwnProperty;g=e("./util"),d=g.to_uvw,f=g.to_xy,b=e("./game").Game,c=e("./semirom").Semirom,a.exports=function(){var a,e,g,i,j,k,l,m,n,o,p,q;i=void 0,l=Raphael("paper","100%","100%"),n=60,o=$("#paper").width(),j=$("#paper").height(),p=o/2,q=j/2,e={},e[TRI_TYPE_COUNTER]={0:"#16A4FD",1:"#F8D200"},e[TRI_TYPE_POINT]={0:"#82126A",1:"#FF6E00"},e[TRI_TYPE_COMMON]={0:"black",1:"black"},k=function(){var c,d,e,f;i=new b,l.clear(),e=i.grid.triangles,f=[];for(c in e){if(!h.call(e,c))continue;d=e[c],f.push(a(n,d.u,d.v,d.w,p,q))}return f},a=function(a,b,c,d,e,g,h){var i,j,k,m,n,o,p,q,r,s;h==null&&(h="red"),n=Math.sqrt(3)*a/6,i=Math.sqrt(3)*a/3,k=Math.sqrt(3)*a/2,s=f(a,b,c,d),q=s[0],r=s[1],q+=e,r+=g,p=(b+c+d)%2===0,p?(m=["M",q,r-i,"L",q+a/2,r+n,"L",q-a/2,r+n,"Z"],j=Math.round(q)+"/"+Math.round(r+c*n)):(m=["M",q,r+i,"L",q+a/2,r-n,"L",q-a/2,r-n,"Z"],j=Math.round(q)+"/"+Math.round(r+c*n+n)),o=l.path(m);return o.attr({fill:h,"stroke-width":.1,stroke:"white"})},g=0,m=!0,$(document).click(function(b){var f,h,j,l,o,r,s,t,u,v,w,x,y,z,A;if(!!m){console.debug("make move"),v=b.pageX-p-$("#paper").offset().left,w=b.pageY-q-$("#paper").offset().top,z=d(n,v,w),s=z[0],t=z[1],u=z[2],l=g%2,o=new c({u:s,v:t,w:u},l),j=[];try{j=i.put(o),g++}catch(B){if(B.playerWon!=null)alert(""+B.playerWon+" won the game"),k();else throw B}A=[];for(x=0,y=j.length;x<y;x++)h=j[x],console.debug(h),A.push(function(){var b,c,d,g,i;d=h.triangles,i=[];for(b=0,c=d.length;b<c;b++)r=d[b],f=(g=e[r.type][r.playerId])!=null?g:"black",console.log(f),i.push(a(n,r.u,r.v,r.w,p,q,f));return i}());return A}}),$(document).mousemove(function(a){var b,c,e,f,g,h;f=a.pageX-p-$("#paper").offset().left,g=a.pageY-q-$("#paper").offset().top,h=d(n,f,g),b=h[0],c=h[1],e=h[2],$("#xy").html(""+Math.round(f)+", "+Math.round(g));return $("#uvw").html(""+b+" , "+c+", "+e)});return k()}}).call(this)}.call(a.exports),__require.modules["/standalone.coffee"]._cached=a.exports;return a.exports}
